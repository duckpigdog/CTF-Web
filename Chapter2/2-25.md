### call_user_func() 动态调用

话不多说，直接上题（青少年 CTF 练习平台）

![](https://pic1.imgdb.cn/item/683957c458cb8da5c81cdf73.png)

打开页面给出了源码

```php
<?php
error_reporting(0);
highlight_file(__FILE__);
extract($_GET);

$token = false;
if(isset($param1) && isset($param2)){
    if(sha1($param1) == sha1($param2)){
        $token = true;
        echo "Level 1 pass\n";
    }
}

class TYctf{
    public $person = 20;
    public $computer_number = 30;

    function getNumber(){
        if(isset($this->person)) {
            echo $this->person;
        }
    }
    function isFullUse(){
        if($this->person != $this->computer_number){
            echo "computer is lacking !!!\n";
        }
        else{
            echo "computer is enough !!!\n";
        }
    }
    static function getKey(){
        include ("flag.php");
        echo "Level 2 pass\n";
        echo "You are winner, this is your reward: \n";
        echo $flag;
    }
}

if($token){
    call_user_func($_POST['payload']);
}

?>
```

第一关让 `param1` 和 `param2` 传递的值相同即可

第二关当 `$token` 为 `true` 时，代码执行

```php
call_user_func($_POST['payload']);
```

这意味着可以通过 POST 请求中的 `payload` 参数调用任意函数

题目中定义了一个类 `TYctf`，其中有一个静态方法 `getKey()`，该方法包含了 `flag.php` 文件并输出 `$flag`

因此设置 payload

```php
payload=TYctf::getKey
```

![](https://pic1.imgdb.cn/item/6839585c58cb8da5c81ce264.png)