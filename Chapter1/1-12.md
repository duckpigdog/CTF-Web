### .hg 文件泄露

话不多说，直接上题（CTFHUB）

![](https://pic1.imgdb.cn/item/6878d0de58cb8da5c8bec787.png)

扫描发现有 `.hg/` 目录，确认是  `.hg`  泄露

使用 `dvcs-ripper` 工具中的 `rip-hg.pl` 脚本进行 clone

```perl
perl rip-hg.pl -u http://challenge-01f03d0aee8e33f2.sandbox.ctfhub.com:10800/.hg/
```

![](https://pic1.imgdb.cn/item/6878d15758cb8da5c8bec7ac.png)

1️⃣ **00changelog.i**

- **作用**：存储提交历史（changelog）的索引信息
- **内容**：二进制格式，指向实际存储内容（通常在 `store/data` 内的 `.i` / `.d` 文件）
- **理解**：类似 Git 的 `refs`，用于追踪变更集元信息的位置
- **扩展**：如果被删，仓库历史版本就会断裂不可恢复

------

2️⃣ **dirstate**

- **作用**：跟踪当前工作区（Working Directory）的状态
- **内容**：记录哪些文件被追踪，哪些被修改、添加、删除
- **理解**：Mercurial 使用它来快速判断 `status`
- **结构**：二进制，包含：
  - 当前父提交节点 ID
  - 文件状态（正常 / 修改 / 删除 / 添加 / 忽略 / 未追踪）
  - 时间戳缓存信息等

------

3️⃣ **last-message.txt**

- **作用**：记录最近一次提交信息的提交说明
- **内容**：纯文本，通常是最近一次 `hg commit -m '...'` 的内容
- **用途**：辅助撤销、恢复操作

------

4️⃣ **requires**

- **作用**：列出该仓库所依赖的 Mercurial 功能模块

- **内容**：文本格式，每行一个模块名。例如：

  ```
  revlogv1
  store
  fncache
  ```

- **影响**：Mercurial 启动仓库时读取它，确保兼容性

- **常见值**：

  - `revlogv1`：使用 revlog 第一版格式
  - `store`：数据在 `.hg/store`
  - `fncache`：文件名缓存机制（避免路径过长）

------

5️⃣ **undo.branch**

- **作用**：记录 `undo` 操作时恢复的分支
- **内容**：纯文本，分支名
- **用途**：撤销到该分支

------

6️⃣ **undo.desc**

- **作用**：记录 `undo` 的描述信息
- **内容**：纯文本，比如 "update"、"revert"
- **用途**：提示你撤销了什么操作

------

7️⃣ **undo.dirstate**

- **作用**：撤销时使用的 `dirstate` 快照
- **内容**：二进制，同 `dirstate` 格式
- **用途**：`hg undo` 时恢复工作目录状态

------

8️⃣ **store/**

- **作用**：存储仓库所有版本数据的核心目录
- **内容**：
  - `00manifest.i`: 跟踪清单（manifest）的索引
  - `data/`: 存放具体文件变更的 revlog 数据
  - `phaseroots`, `obsstore`: 变更历史的高级特性数据（可能未启用）
- **结构**：使用 `.i`（索引）与 `.d`（数据）二进制文件配对
- **重要性**：这里存储了全部版本数据。如果被破坏，仓库彻底失效

------

9️⃣ **wcache/**

- **作用**：`working directory cache`
- **内容**：缓存某些工作目录的状态，辅助性能
- **影响**：删除它不会丢数据，只是性能下降（会重新生成）

拿到 flag 名

![](https://pic1.imgdb.cn/item/6878d1e658cb8da5c8bec7d3.png)